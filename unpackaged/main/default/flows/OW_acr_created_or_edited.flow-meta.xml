<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>52.0</apiVersion>
    <assignments>
        <description>Clears the household from the customer account given this is no longer their primary group. Follow on actions are processed from a person account flow.</description>
        <name>Clear_household</name>
        <label>Clear household</label>
        <locationX>314</locationX>
        <locationY>695</locationY>
        <assignmentItems>
            <assignToReference>customer_account.Household_Lookup__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.OW_role_in_primary_household__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.OW_customer_flag__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue></stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Contact.AccountId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_needed</targetReference>
        </connector>
    </assignments>
    <assignments>
        <description>Sets the household field and the role in primary household field on the customer account given this has changed.</description>
        <name>Set_role_in_primary_household</name>
        <label>Set household and role</label>
        <locationX>50</locationX>
        <locationY>695</locationY>
        <assignmentItems>
            <assignToReference>customer_account.Household_Lookup__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.OW_customer_flag__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Account.OW_customer_flag__c</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Contact.AccountId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>customer_account.OW_role_in_primary_household__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.Roles</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_needed</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Account_type</name>
        <label>Account type</label>
        <locationX>534</locationX>
        <locationY>455</locationY>
        <defaultConnectorLabel>Other</defaultConnectorLabel>
        <rules>
            <name>Household</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.Account.RecordTypeId</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <elementReference>household_account_record_type_id</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Primary_group_updates_needed_decision</targetReference>
            </connector>
            <label>Household</label>
        </rules>
    </decisions>
    <decisions>
        <description>If this is the primary group for the customer and details on the customer account controlled by the relationship are not up to date, route for update. If no longer the primary group, clear the values on the customer account controlled by the primary relationship. Otherwise do nothing.</description>
        <name>Primary_group_updates_needed_decision</name>
        <label>Primary group updates needed?</label>
        <locationX>314</locationX>
        <locationY>575</locationY>
        <defaultConnector>
            <targetReference>Update_needed</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No updates needed</defaultConnectorLabel>
        <rules>
            <name>Primary_group_updates_needed_outcome</name>
            <conditionLogic>1 AND ( 2 OR 3 OR 4)</conditionLogic>
            <conditions>
                <leftValueReference>$Record.FinServ__PrimaryGroup__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Roles</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Contact.Account.OW_role_in_primary_household__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.AccountId</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Contact.Account.Household_Lookup__c</elementReference>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.Account.OW_customer_flag__c</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>$Record.Contact.Account.OW_customer_flag__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_role_in_primary_household</targetReference>
            </connector>
            <label>Primary group updates needed</label>
        </rules>
        <rules>
            <name>No_longer_primary_group</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$Record.FinServ__PrimaryGroup__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>$Record.FinServ__PrimaryGroup__c</leftValueReference>
                <operator>IsChanged</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Clear_household</targetReference>
            </connector>
            <label>No longer primary group</label>
        </rules>
    </decisions>
    <decisions>
        <description>If an update is needed, route to an update action to commit this. Otherwise do nothing.</description>
        <name>Update_needed</name>
        <label>Update needed?</label>
        <locationX>314</locationX>
        <locationY>911</locationY>
        <defaultConnectorLabel>No update</defaultConnectorLabel>
        <rules>
            <name>Update_needed_outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>customer_account</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_the_customer_account</targetReference>
            </connector>
            <label>Update needed</label>
        </rules>
    </decisions>
    <description>When an account contact relationship is created or edited, appropriately update the &quot;household&quot; and &quot;role in primary household&quot; field on the person account as well.</description>
    <formulas>
        <description>Returns true if this a new record</description>
        <name>is_new</name>
        <dataType>Boolean</dataType>
        <expression>ISNEW()</expression>
    </formulas>
    <interviewLabel>ACR - created or edited {!$Flow.CurrentDateTime}</interviewLabel>
    <label>ACR - created or edited</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <description>Make an update to the customer account using the values changed in the flow.</description>
        <name>Update_the_customer_account</name>
        <label>Update the customer account</label>
        <locationX>182</locationX>
        <locationY>1031</locationY>
        <inputReference>customer_account</inputReference>
    </recordUpdates>
    <start>
        <locationX>408</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_component_references</targetReference>
        </connector>
        <object>AccountContactRelation</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Get_component_references</name>
        <label>Get component references</label>
        <locationX>534</locationX>
        <locationY>335</locationY>
        <connector>
            <targetReference>Account_type</targetReference>
        </connector>
        <flowName>OW_component_reference_set_component_ids</flowName>
        <outputAssignments>
            <assignToReference>household_account_record_type_id</assignToReference>
            <name>household_account_record_type_id</name>
        </outputAssignments>
    </subflows>
    <variables>
        <description>Stores the details of changes made to the customer account related to this account contact relationship.</description>
        <name>customer_account</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <description>Stores the ID of the household account record type</description>
        <name>household_account_record_type_id</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
