<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>Update_User</name>
        <label>Update User</label>
        <locationX>242</locationX>
        <locationY>528</locationY>
        <actionName>OctopusWealthPortal.updateUser</actionName>
        <actionType>externalService</actionType>
        <flowTransactionModel>CurrentTransaction</flowTransactionModel>
        <inputParameters>
            <name>body</name>
            <value>
                <elementReference>UpdateUserBody</elementReference>
            </value>
        </inputParameters>
        <nameSegment>OctopusWealthPortal.updateUser</nameSegment>
        <storeOutputAutomatically>true</storeOutputAutomatically>
        <versionSegment>1</versionSegment>
    </actionCalls>
    <apiVersion>57.0</apiVersion>
    <assignments>
        <name>Update_User_Assignment</name>
        <label>Update User Assignment</label>
        <locationX>242</locationX>
        <locationY>408</locationY>
        <assignmentItems>
            <assignToReference>UpdateUserBody.currentEmail</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.PersonEmail</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>UpdateUserBody.mobileNumber</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>$Record.PersonMobilePhone</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Update_User</targetReference>
        </connector>
    </assignments>
    <decisions>
        <name>Int_user</name>
        <label>Int user</label>
        <locationX>374</locationX>
        <locationY>288</locationY>
        <defaultConnectorLabel>Not integration user</defaultConnectorLabel>
        <rules>
            <name>Is_integration_user</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>$User.OW_user_type__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>Integration</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Update_User_Assignment</targetReference>
            </connector>
            <label>Is integration user</label>
        </rules>
    </decisions>
    <description>Business use: where a customer adds their mobile number through the portal, this flow ensures the updates makes it across all systems so that it can be used for other purposes like MFA.
Tech use: when a customer updates their mobile in their portal, the update is made directly in Salesforce. This flow sends the update to the portal endpoint to then be updated in cognito.</description>
    <environments>Default</environments>
    <interviewLabel>Account | Send updated mobile to portal {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Account | Send updated mobile to portal</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>PortalAccountStatus__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>PersonMobilePhone</field>
            <operator>IsChanged</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <object>Account</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <scheduledPaths>
            <connector>
                <targetReference>Int_user</targetReference>
            </connector>
            <pathType>AsyncAfterCommit</pathType>
        </scheduledPaths>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <variables>
        <name>UpdateUserBody</name>
        <apexClass>ExternalService__OctopusWealthPortal_UpdateUserBody</apexClass>
        <dataType>Apex</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
