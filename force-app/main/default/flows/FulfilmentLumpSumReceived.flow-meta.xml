<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>56.0</apiVersion>
    <description>Screen flow to collect old process fulfilment details. Should be deactivated once all v2 fulfilment has been completed.</description>
    <environments>Default</environments>
    <formulas>
        <name>addresseeText</name>
        <dataType>String</dataType>
        <expression>{!primaryClientName} + {!jointOwnerName}</expression>
    </formulas>
    <formulas>
        <name>jointOwnerName</name>
        <dataType>String</dataType>
        <expression>IF( ISBLANK({!Get_fulfilment.Destination__r.FinServ__JointOwner__c}), &quot;&quot;,
IF( ISBLANK({!Get_fulfilment.Destination__r.FinServ__JointOwner__r.FinServ__PreferredName__pc}),
&quot; and &quot; + {!Get_fulfilment.Destination__r.FinServ__JointOwner__r.FirstName},
&quot; and &quot; + {!Get_fulfilment.Destination__r.FinServ__JointOwner__r.FinServ__PreferredName__pc})
)</expression>
    </formulas>
    <formulas>
        <name>primaryClientName</name>
        <dataType>String</dataType>
        <expression>IF( ISBLANK({!Get_fulfilment.Destination__r.FinServ__PrimaryOwner__r.FinServ__PreferredName__pc}),
{!Get_fulfilment.Destination__r.FinServ__PrimaryOwner__r.FirstName},
{!Get_fulfilment.Destination__r.FinServ__PrimaryOwner__r.FinServ__PreferredName__pc})</expression>
    </formulas>
    <interviewLabel>Fulfilment - lump sum received {!$Flow.CurrentDateTime}</interviewLabel>
    <label>zOLDPROCESS Fulfilment - lump sum received</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordLookups>
        <name>Get_fulfilment</name>
        <label>Get fulfilment</label>
        <locationX>176</locationX>
        <locationY>134</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_recommendation</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Fulfillment__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordLookups>
        <name>Get_recommendation</name>
        <label>Get recommendation</label>
        <locationX>176</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Collect_details</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>FulfilmentLegacy__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_fulfilment.Id</elementReference>
            </value>
        </filters>
        <getFirstRecordOnly>true</getFirstRecordOnly>
        <object>Recommendation__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordUpdates>
        <name>Complete_task</name>
        <label>Complete task</label>
        <locationX>176</locationX>
        <locationY>674</locationY>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WhatId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_fulfilment.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>OW_task_information_name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>chase_client_payment</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </filters>
        <filters>
            <field>Status</field>
            <operator>NotEqualTo</operator>
            <value>
                <stringValue>Pushed</stringValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </inputAssignments>
        <object>Task</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_fulfilment</name>
        <label>Update fulfilment</label>
        <locationX>176</locationX>
        <locationY>458</locationY>
        <connector>
            <targetReference>Update_product</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>Date_Chasing_Complete__c</field>
            <value>
                <elementReference>Date_payment_received</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Date_Received__c</field>
            <value>
                <elementReference>Date_payment_received</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>Status__c</field>
            <value>
                <stringValue>Investment Checks</stringValue>
            </value>
        </inputAssignments>
        <object>Fulfillment__c</object>
    </recordUpdates>
    <recordUpdates>
        <name>Update_product</name>
        <label>Update product</label>
        <locationX>176</locationX>
        <locationY>566</locationY>
        <connector>
            <targetReference>Complete_task</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>Get_fulfilment.Destination__c</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>FP_Date_of_valuation__c</field>
            <value>
                <elementReference>$Flow.CurrentDate</elementReference>
            </value>
        </inputAssignments>
        <inputAssignments>
            <field>FP_Value__c</field>
            <value>
                <elementReference>Current_value</elementReference>
            </value>
        </inputAssignments>
        <object>FinServ__FinancialAccount__c</object>
    </recordUpdates>
    <runInMode>SystemModeWithSharing</runInMode>
    <screens>
        <name>Collect_details</name>
        <label>Collect details</label>
        <locationX>176</locationX>
        <locationY>350</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>true</allowPause>
        <connector>
            <targetReference>Update_fulfilment</targetReference>
        </connector>
        <fields>
            <name>Date_payment_received</name>
            <dataType>Date</dataType>
            <defaultValue>
                <elementReference>$Flow.CurrentDate</elementReference>
            </defaultValue>
            <fieldText>Date payment received</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
        </fields>
        <fields>
            <name>Value_received</name>
            <dataType>Number</dataType>
            <defaultValue>
                <elementReference>Get_fulfilment.Expected_Amount__c</elementReference>
            </defaultValue>
            <fieldText>Value received</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <scale>0</scale>
        </fields>
        <fields>
            <name>Current_value</name>
            <dataType>Number</dataType>
            <fieldText>Today&#39;s value of policy</fieldText>
            <fieldType>InputField</fieldType>
            <isRequired>true</isRequired>
            <scale>2</scale>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>true</showHeader>
    </screens>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Get_fulfilment</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <textTemplates>
        <name>emailBody</name>
        <isViewedAsPlainText>true</isViewedAsPlainText>
        <text>&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;en&quot;&gt;
&lt;head&gt;
  
&lt;meta name=&quot;color-scheme&quot; content=&quot;light only&quot;&gt;
&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;
&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1&quot;&gt;
&lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;

  &lt;title&gt;title is title&lt;/title&gt;
  
&lt;style type=&quot;text/css&quot;&gt;
@media screen and (min-width:600px) {
h1 {
font-size: 48px !important;
line-height: 48px !important;
}

.intro {
font-size: 24px !important;
line-height: 36px !important;
}
}
&lt;/style&gt;

&lt;/head&gt;
&lt;body style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; height: 100%; margin: 0; padding: 0; width: 100%;&quot;&gt;
  &lt;div id=&quot;app&quot; role=&quot;article&quot; aria-label=&quot;An email from Octopus Wealth&quot; lang=&quot;en&quot; style=&quot;background-color: white; color: #2b2b2b; font-family: &#39;Avenir Next&#39;, -apple-system, BlinkMacSystemFont, &#39;Segoe UI&#39;, Roboto, Helvetica, Arial, sans-serif, &#39;Apple Color Emoji&#39;, &#39;Segoe UI Emoji&#39;, &#39;Segoe UI Symbol&#39;; font-size: 18px; font-weight: 400; line-height: 28px; margin: 0 auto; max-width: 720px; padding: 40px 20px 40px 20px;&quot;&gt;
    &lt;header&gt;
      
&lt;a href=&quot;https://octopuswealth.com/&quot; style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; color: #6D087C; font-weight: 600; text-decoration: underline;&quot;&gt;
&lt;center&gt;
&lt;img id=&quot;ow-logo&quot; src=&quot;https://bucketeer-ff170b78-efdb-46a7-9a03-a5b7fa0f4bd8.s3.eu-west-1.amazonaws.com/Wealth_logo_dark_600px_e7d176316c.png&quot; alt=&quot;Octopus Wealth&quot; style=&quot;-ms-interpolation-mode: bicubic; border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; margin-bottom: 24px; width: 200px;&quot; width=&quot;200&quot;&gt;
&lt;/center&gt;
&lt;/a&gt;
    &lt;/header&gt;
    
    &lt;main style=&quot;font-size: 18px;&quot;&gt;
&lt;p&gt;Hi {!addresseeText}&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Many thanks for sending your payment of £{!Value_received} to your Octopus {!Get_fulfilment.Destination__r.FinServ__RecordTypeName__c}.&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;The new funds will be added to your policy in line with our advice. You can monitor the ongoing value of your assets through our portal and this will be updated in the coming days.&lt;/p&gt;&lt;br&gt;&lt;p&gt;If you have any questions, please do get in touch.&lt;/p&gt;

&lt;p&gt;Kind regards,&lt;/p&gt;

&lt;p&gt;The Octopus Wealth Team&lt;/p&gt;
    &lt;/main&gt;
    
    
&lt;footer style=&quot;color: #999999; border-top: 1px solid #C1C1C1;&quot;&gt;
&lt;br&gt;
&lt;table border=&quot;0&quot; cellpadding=&quot;0&quot; cellspacing=&quot;0&quot; role=&quot;presentation&quot; style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; mso-table-lspace: 0pt; mso-table-rspace: 0pt; border-collapse: collapse;&quot;&gt;
&lt;a href=&quot;https://twitter.com/OctopusWealth/&quot; style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; color: #6D087C; font-weight: 600; margin-right: 16px; text-decoration: none;&quot;&gt;
&lt;img class=&quot;social&quot; alt=&quot;twitter&quot; src=&quot;https://bucketeer-ff170b78-efdb-46a7-9a03-a5b7fa0f4bd8.s3.eu-west-1.amazonaws.com/social_twitter_388e2fc313.png&quot; style=&quot;-ms-interpolation-mode: bicubic; border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; width: 24px;&quot; width=&quot;24&quot;&gt;
&lt;/a&gt;
&lt;a border=&quot;0&quot; href=&quot;https://www.facebook.com/octowealth/&quot; style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; color: #6D087C; font-weight: 600; margin-right: 16px; text-decoration: none;&quot;&gt;
&lt;img class=&quot;social&quot; alt=&quot;facebook&quot; src=&quot;https://bucketeer-ff170b78-efdb-46a7-9a03-a5b7fa0f4bd8.s3.eu-west-1.amazonaws.com/social_facebook_89c79a9dad.png&quot; style=&quot;-ms-interpolation-mode: bicubic; border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; width: 24px;&quot; width=&quot;24&quot;&gt;
&lt;/a&gt;
&lt;a href=&quot;https://www.linkedin.com/company/octopus-wealth/&quot; style=&quot;-webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; color: #6D087C; font-weight: 600; margin-right: 16px; text-decoration: none;&quot;&gt;
&lt;img class=&quot;social&quot; alt=&quot;linkedin&quot; src=&quot;https://bucketeer-ff170b78-efdb-46a7-9a03-a5b7fa0f4bd8.s3.eu-west-1.amazonaws.com/social_linkedin_d7d382ff3f.png&quot; style=&quot;-ms-interpolation-mode: bicubic; border: 0; height: auto; line-height: 100%; outline: none; text-decoration: none; width: 24px;&quot; width=&quot;24&quot;&gt;
&lt;/a&gt;
&lt;/table&gt;
&lt;p class=&quot;small-text&quot; style=&quot;font-size: 12px; margin-top: 0; margin-bottom: 8px;&quot;&gt;This is a transactional email from Octopus Wealth (which is why you won’t find an unsubscribe link).
&lt;br&gt;

&lt;/p&gt;&lt;p class=&quot;small-text&quot; style=&quot;font-size: 12px; margin-top: 0; margin-bottom: 8px;&quot;&gt;Octopus Wealth Limited is authorised and regulated by the Financial Conduct Authority (FRN: 778951) and is a limited company registered in England &amp; Wales (10739796) at 33 Holborn, London EC1N 2HT.&lt;/p&gt;

&lt;/footer&gt;

  &lt;/div&gt;
&lt;/body&gt;
&lt;/html&gt;</text>
    </textTemplates>
    <variables>
        <name>emailAddresses</name>
        <dataType>String</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
</Flow>
