<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>52.0</apiVersion>
    <assignments>
        <description>Sets the unique check field to be the concatenation of the advice and LOA IDs</description>
        <name>Set_unique_check</name>
        <label>Set unique check</label>
        <locationX>176</locationX>
        <locationY>311</locationY>
        <assignmentItems>
            <assignToReference>$Record.OW_unique_check__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>unique_check_value</elementReference>
            </value>
        </assignmentItems>
    </assignments>
    <description>Before save flow to make updates to the records in the LOA to advice object before they are saved. Used to ensure uniqueness and prevent linking an LOA to the same advice record more than once.</description>
    <formulas>
        <description>A concatenation of the advice and LOA IDs</description>
        <name>unique_check_value</name>
        <dataType>String</dataType>
        <expression>{!$Record.Advice__c} + {!$Record.LOA__c}</expression>
    </formulas>
    <interviewLabel>LOA to advice - before save {!$Flow.CurrentDateTime}</interviewLabel>
    <label>LOA to advice - before save</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Set_unique_check</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Advice__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>LOA__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <object>LOA_to_Advice__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordBeforeSave</triggerType>
    </start>
    <status>Active</status>
</Flow>
