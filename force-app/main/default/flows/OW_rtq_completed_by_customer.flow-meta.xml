<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <apiVersion>52.0</apiVersion>
    <description>When an RTQ record is updated to closed/cancelled/delegated, indicating it&#39;s completed by the customer/requires no further action, this flow will run. It will update the customer RTQ status to complete and the household RTQ status if there are no open RTQ records on the household.
Will also close the open Chase RTQ task.</description>
    <environments>Default</environments>
    <interviewLabel>RTQ - updated to complete {!$Flow.CurrentDateTime}</interviewLabel>
    <label>RTQ - completed by customer</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>AutoLaunchedFlow</processType>
    <recordUpdates>
        <name>Close_open_chase_RTQ_task</name>
        <label>Close open chase RTQ task</label>
        <locationX>176</locationX>
        <locationY>335</locationY>
        <connector>
            <targetReference>Call_person_account_update_flow</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>WhatId</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>$Record.Id</elementReference>
            </value>
        </filters>
        <filters>
            <field>OW_task_information_name__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>chase_rtq</stringValue>
            </value>
        </filters>
        <filters>
            <field>IsClosed</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <inputAssignments>
            <field>Status</field>
            <value>
                <stringValue>Completed</stringValue>
            </value>
        </inputAssignments>
        <object>Task</object>
    </recordUpdates>
    <start>
        <locationX>50</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Close_open_chase_RTQ_task</targetReference>
        </connector>
        <doesRequireRecordChangedToMeetCriteria>true</doesRequireRecordChangedToMeetCriteria>
        <filterLogic>1 AND 2</filterLogic>
        <filters>
            <field>OW_completed_by_client__c</field>
            <operator>IsNull</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>OW_status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Closed</stringValue>
            </value>
        </filters>
        <object>OW_rtq__c</object>
        <recordTriggerType>CreateAndUpdate</recordTriggerType>
        <triggerType>RecordAfterSave</triggerType>
    </start>
    <status>Active</status>
    <subflows>
        <name>Call_person_account_update_flow</name>
        <label>Call person account update flow</label>
        <locationX>176</locationX>
        <locationY>455</locationY>
        <connector>
            <targetReference>Set_household_RTQ_status</targetReference>
        </connector>
        <flowName>OW_account_rtq_sub</flowName>
        <inputAssignments>
            <name>RTQ</name>
            <value>
                <elementReference>$Record</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <subflows>
        <name>Set_household_RTQ_status</name>
        <label>Set household RTQ status</label>
        <locationX>176</locationX>
        <locationY>575</locationY>
        <flowName>OW_Rtq_evaluate_household_Rtq_status</flowName>
        <inputAssignments>
            <name>householdId</name>
            <value>
                <elementReference>$Record.OW_household__c</elementReference>
            </value>
        </inputAssignments>
    </subflows>
    <variables>
        <description>Stores either the customer or household account details.</description>
        <name>Account</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <description>A collection variable that will store the current customer and household accounts with RTQ status values of complete</description>
        <name>Customer_and_household_account</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
</Flow>
