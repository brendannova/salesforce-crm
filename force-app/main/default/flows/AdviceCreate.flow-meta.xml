<?xml version="1.0" encoding="UTF-8"?>
<Flow xmlns="http://soap.sforce.com/2006/04/metadata">
    <actionCalls>
        <name>GetAdviceChecklistRecordTypeId</name>
        <label>Get advice checklist record type ID</label>
        <locationX>578</locationX>
        <locationY>2588</locationY>
        <actionName>FlowUtilityGetRecordTypeId</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Update_advice_checklist</targetReference>
        </connector>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>recordTypeDeveloperName</name>
            <value>
                <elementReference>AdviceTypeSelect.firstSelectedRow.AdviceChecklistRecordTypeDeveloperName__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sObjectType</name>
            <value>
                <stringValue>AdviceChecklist__c</stringValue>
            </value>
        </inputParameters>
        <nameSegment>FlowUtilityGetRecordTypeId</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <actionCalls>
        <name>GetAdviceRecordTypeId</name>
        <label>Get advice record type ID</label>
        <locationX>666</locationX>
        <locationY>1856</locationY>
        <actionName>FlowUtilityGetRecordTypeId</actionName>
        <actionType>apex</actionType>
        <connector>
            <targetReference>Advice_method_restricted</targetReference>
        </connector>
        <flowTransactionModel>Automatic</flowTransactionModel>
        <inputParameters>
            <name>recordTypeDeveloperName</name>
            <value>
                <elementReference>AdviceTypeSelect.firstSelectedRow.RecordTypeDeveloperName__c</elementReference>
            </value>
        </inputParameters>
        <inputParameters>
            <name>sObjectType</name>
            <value>
                <stringValue>Advice__c</stringValue>
            </value>
        </inputParameters>
        <nameSegment>FlowUtilityGetRecordTypeId</nameSegment>
        <offset>0</offset>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </actionCalls>
    <apiVersion>59.0</apiVersion>
    <assignments>
        <name>Set_advice_ID</name>
        <label>Set advice ID</label>
        <locationX>754</locationX>
        <locationY>350</locationY>
        <assignmentItems>
            <assignToReference>advice.Id</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>adviceId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>adviceChecklistId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>advice.AdviceChecklist__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <isGoTo>true</isGoTo>
            <targetReference>Get_household</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_advice_method</name>
        <label>Set advice method</label>
        <locationX>534</locationX>
        <locationY>2072</locationY>
        <assignmentItems>
            <assignToReference>advice.AdviceMethod__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AdviceTypeSelect.firstSelectedRow.AdviceMethod__c</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Set_advice_values</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_advice_values</name>
        <label>Set advice values</label>
        <locationX>666</locationX>
        <locationY>2264</locationY>
        <assignmentItems>
            <assignToReference>advice.OW_notes__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AdviceNotes</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.Name</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AdviceName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.Subject__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AdviceName</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.RecordTypeId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>GetAdviceRecordTypeId.recordTypeId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.Advice_Status__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>adviceStatusInitial</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.AdviceType__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>AdviceTypeSelect.firstSelectedRow.Id</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.New_or_existing_client__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Existing</stringValue>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.RtqStatus__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>rtqStatus</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.OW_review__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>reviewId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Create_or_update</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_defaults</name>
        <label>Set defaults</label>
        <locationX>666</locationX>
        <locationY>824</locationY>
        <assignmentItems>
            <assignToReference>advice.Advice_Household__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>householdId</elementReference>
            </value>
        </assignmentItems>
        <assignmentItems>
            <assignToReference>advice.Partner__c</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>partnerDefault</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Any_ongoing_advice</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_household_ID</name>
        <label>Set household ID</label>
        <locationX>314</locationX>
        <locationY>242</locationY>
        <assignmentItems>
            <assignToReference>householdId</assignToReference>
            <operator>Assign</operator>
            <value>
                <elementReference>recordId</elementReference>
            </value>
        </assignmentItems>
        <connector>
            <targetReference>Search_for_open_advice</targetReference>
        </connector>
    </assignments>
    <assignments>
        <name>Set_unknown_launch_error</name>
        <label>Set unknown launch error</label>
        <locationX>1018</locationX>
        <locationY>242</locationY>
        <assignmentItems>
            <assignToReference>errorMessage</assignToReference>
            <operator>Assign</operator>
            <value>
                <stringValue>Unknown how advice create flow was launched. Please raise a product ticket.</stringValue>
            </value>
        </assignmentItems>
    </assignments>
    <decisions>
        <name>Advice_method_restricted</name>
        <label>Advice method restricted</label>
        <locationX>666</locationX>
        <locationY>1964</locationY>
        <defaultConnector>
            <targetReference>Set_advice_values</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not restricted</defaultConnectorLabel>
        <rules>
            <name>Restricted</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>AdviceTypeSelect.firstSelectedRow.AdviceMethod__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>PRESENTED</stringValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>AdviceTypeSelect.firstSelectedRow.AdviceMethod__c</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <stringValue>NON_PRESENTED</stringValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_advice_method</targetReference>
            </connector>
            <label>Restricted</label>
        </rules>
    </decisions>
    <decisions>
        <name>Any_ongoing_advice</name>
        <label>Any ongoing advice?</label>
        <locationX>666</locationX>
        <locationY>932</locationY>
        <defaultConnector>
            <targetReference>Get_advice_types</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not found</defaultConnectorLabel>
        <rules>
            <name>Advice_found</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>Search_for_open_advice</leftValueReference>
                <operator>IsEmpty</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Existing_advice_check</targetReference>
            </connector>
            <label>Advice found</label>
        </rules>
    </decisions>
    <decisions>
        <name>Checklist_update</name>
        <label>Checklist update</label>
        <locationX>710</locationX>
        <locationY>2480</locationY>
        <defaultConnector>
            <targetReference>Update_advice</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Not required</defaultConnectorLabel>
        <rules>
            <name>Required</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>adviceChecklistId</leftValueReference>
                <operator>IsBlank</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>advice.AdviceChecklist__r.RecordType.DeveloperName</leftValueReference>
                <operator>NotEqualTo</operator>
                <rightValue>
                    <elementReference>AdviceTypeSelect.firstSelectedRow.AdviceChecklistRecordTypeDeveloperName__c</elementReference>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>GetAdviceChecklistRecordTypeId</targetReference>
            </connector>
            <label>Required</label>
        </rules>
    </decisions>
    <decisions>
        <name>Create_or_update</name>
        <label>Create or update</label>
        <locationX>666</locationX>
        <locationY>2372</locationY>
        <defaultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Roll_back_changes</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Unknown</defaultConnectorLabel>
        <rules>
            <name>Create</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>updateAdvice</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Insert_advice</targetReference>
            </connector>
            <label>Create</label>
        </rules>
        <rules>
            <name>Update</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>updateAdvice</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Checklist_update</targetReference>
            </connector>
            <label>Update</label>
        </rules>
    </decisions>
    <decisions>
        <name>Created_from</name>
        <label>Created from</label>
        <locationX>666</locationX>
        <locationY>3236</locationY>
        <defaultConnector>
            <targetReference>Redirect_to_advice</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Household</defaultConnectorLabel>
        <rules>
            <name>Linked</name>
            <conditionLogic>or</conditionLogic>
            <conditions>
                <leftValueReference>isReview</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <label>Review</label>
        </rules>
    </decisions>
    <decisions>
        <name>Launched_from</name>
        <label>Launched from</label>
        <locationX>666</locationX>
        <locationY>134</locationY>
        <defaultConnector>
            <targetReference>Set_unknown_launch_error</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>Unknown</defaultConnectorLabel>
        <rules>
            <name>Household_outcome</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>recordId</leftValueReference>
                <operator>IsBlank</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Set_household_ID</targetReference>
            </connector>
            <label>Household</label>
        </rules>
        <rules>
            <name>Review_create_advice</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>isReview</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>updateAdvice</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Search_for_open_advice</targetReference>
            </connector>
            <label>Review - create advice</label>
        </rules>
        <rules>
            <name>Review_change_advice_type</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>isReview</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <conditions>
                <leftValueReference>updateAdvice</leftValueReference>
                <operator>EqualTo</operator>
                <rightValue>
                    <booleanValue>true</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Get_advice_record</targetReference>
            </connector>
            <label>Review - change advice type</label>
        </rules>
    </decisions>
    <decisions>
        <name>Warning_to_display</name>
        <label>Warning to display?</label>
        <locationX>666</locationX>
        <locationY>1448</locationY>
        <defaultConnector>
            <targetReference>Get_advice_details</targetReference>
        </defaultConnector>
        <defaultConnectorLabel>No warning</defaultConnectorLabel>
        <rules>
            <name>Warning</name>
            <conditionLogic>and</conditionLogic>
            <conditions>
                <leftValueReference>AdviceTypeSelect.firstSelectedRow.Warnings__c</leftValueReference>
                <operator>IsNull</operator>
                <rightValue>
                    <booleanValue>false</booleanValue>
                </rightValue>
            </conditions>
            <connector>
                <targetReference>Display_warning</targetReference>
            </connector>
            <label>Warning</label>
        </rules>
    </decisions>
    <description>Screen flow that walks a user through creating new advice.</description>
    <environments>Default</environments>
    <formulas>
        <name>adviceStatusInitial</name>
        <dataType>String</dataType>
        <expression>IF({!AdviceTypeSelect.firstSelectedRow.DeveloperName__c} = &quot;REGULAR_AMENDMENT&quot;, &quot;Prepare advice&quot;, &quot;Setup&quot;)</expression>
    </formulas>
    <formulas>
        <name>clientType</name>
        <dataType>String</dataType>
        <expression>CASE({!household.Type},
&quot;Trust&quot;, &quot;Trust&quot;,
&quot;Retail&quot;)</expression>
    </formulas>
    <formulas>
        <name>nameDefault</name>
        <dataType>String</dataType>
        <expression>IF({!updateAdvice}, {!advice.Name}, {!AdviceTypeSelect.firstSelectedRow.Name} &amp; &quot; | &quot; &amp; {!household.Name})</expression>
    </formulas>
    <formulas>
        <name>partnerDefault</name>
        <dataType>String</dataType>
        <expression>CASE({!AdviceTypeSelect.firstSelectedRow.DeveloperName__c},
&quot;PROTECTION&quot;, null,
{!household.OwnerId})</expression>
    </formulas>
    <formulas>
        <name>rtqStatus</name>
        <dataType>String</dataType>
        <expression>CASE({!AdviceTypeSelect.firstSelectedRow.RiskToleranceQuestionnaireSent__c},
&quot;NEVER&quot;, &quot;No update required&quot;,
&quot;REQUIRED&quot;, &quot;Not started&quot;,
&quot;OPTIONAL&quot;, CASE({!household.OW_rtq_status__c},
&quot;Complete&quot;, &quot;No update required&quot;,
&quot;Pending&quot;, &quot;In progress&quot;,
&quot;Not started&quot;),
&quot;Not started&quot;)</expression>
    </formulas>
    <formulas>
        <name>successToastMessage</name>
        <dataType>String</dataType>
        <expression>IF({!updateAdvice}, &quot;Advice updated&quot;, &quot;Advice created&quot;)</expression>
    </formulas>
    <interviewLabel>AdviceCreate {!$Flow.CurrentDateTime}</interviewLabel>
    <label>Advice | Create</label>
    <processMetadataValues>
        <name>BuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>CanvasMode</name>
        <value>
            <stringValue>AUTO_LAYOUT_CANVAS</stringValue>
        </value>
    </processMetadataValues>
    <processMetadataValues>
        <name>OriginBuilderType</name>
        <value>
            <stringValue>LightningFlowBuilder</stringValue>
        </value>
    </processMetadataValues>
    <processType>Flow</processType>
    <recordCreates>
        <name>Insert_advice</name>
        <label>Insert advice</label>
        <locationX>50</locationX>
        <locationY>2480</locationY>
        <connector>
            <targetReference>Success_toast</targetReference>
        </connector>
        <faultConnector>
            <targetReference>Roll_back_changes</targetReference>
        </faultConnector>
        <inputReference>advice</inputReference>
    </recordCreates>
    <recordLookups>
        <name>Get_advice_record</name>
        <label>Get advice record</label>
        <locationX>754</locationX>
        <locationY>242</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_advice_ID</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>adviceId</elementReference>
            </value>
        </filters>
        <object>Advice__c</object>
        <outputReference>advice</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>OW_notes__c</queriedFields>
        <queriedFields>AdviceChecklist__c</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Get_advice_types</name>
        <label>Get advice types</label>
        <locationX>666</locationX>
        <locationY>1232</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Choose_advice_type</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Active__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>true</booleanValue>
            </value>
        </filters>
        <filters>
            <field>IsOnboarding__c</field>
            <operator>EqualTo</operator>
            <value>
                <booleanValue>false</booleanValue>
            </value>
        </filters>
        <filters>
            <field>IsAnnualReview__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>isReview</elementReference>
            </value>
        </filters>
        <filters>
            <field>ClientType__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>clientType</elementReference>
            </value>
        </filters>
        <object>AdviceType__c</object>
        <outputReference>adviceTypes</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>Description__c</queriedFields>
        <queriedFields>RecordTypeDeveloperName__c</queriedFields>
        <queriedFields>Warnings__c</queriedFields>
        <queriedFields>DeveloperName__c</queriedFields>
        <queriedFields>AdviceChecklistRecordTypeDeveloperName__c</queriedFields>
        <queriedFields>RiskToleranceQuestionnaireSent__c</queriedFields>
        <sortField>Name</sortField>
        <sortOrder>Asc</sortOrder>
    </recordLookups>
    <recordLookups>
        <name>Get_household</name>
        <label>Get household</label>
        <locationX>666</locationX>
        <locationY>716</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Set_defaults</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>householdId</elementReference>
            </value>
        </filters>
        <object>Account</object>
        <outputReference>household</outputReference>
        <queriedFields>Id</queriedFields>
        <queriedFields>ParentId</queriedFields>
        <queriedFields>OwnerId</queriedFields>
        <queriedFields>Name</queriedFields>
        <queriedFields>OW_rtq_status__c</queriedFields>
        <queriedFields>Type</queriedFields>
    </recordLookups>
    <recordLookups>
        <name>Search_for_open_advice</name>
        <label>Search for open advice</label>
        <locationX>666</locationX>
        <locationY>608</locationY>
        <assignNullValuesIfNoRecordsFound>false</assignNullValuesIfNoRecordsFound>
        <connector>
            <targetReference>Get_household</targetReference>
        </connector>
        <filterLogic>1 AND (2 OR 3 OR 4 OR 5 OR 6 OR 7)</filterLogic>
        <filters>
            <field>Advice_Household__c</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>householdId</elementReference>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Setup</stringValue>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Data gathering</stringValue>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Risk Call</stringValue>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Ready for suitability</stringValue>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Suitability in progress</stringValue>
            </value>
        </filters>
        <filters>
            <field>Advice_Status__c</field>
            <operator>EqualTo</operator>
            <value>
                <stringValue>Prepare advice</stringValue>
            </value>
        </filters>
        <getFirstRecordOnly>false</getFirstRecordOnly>
        <object>Advice__c</object>
        <storeOutputAutomatically>true</storeOutputAutomatically>
    </recordLookups>
    <recordRollbacks>
        <name>Roll_back_changes</name>
        <label>Roll back changes</label>
        <locationX>314</locationX>
        <locationY>2588</locationY>
        <connector>
            <targetReference>Error_toast_and_message</targetReference>
        </connector>
    </recordRollbacks>
    <recordUpdates>
        <name>Update_advice</name>
        <label>Update advice</label>
        <locationX>710</locationX>
        <locationY>2888</locationY>
        <connector>
            <targetReference>Success_toast</targetReference>
        </connector>
        <faultConnector>
            <isGoTo>true</isGoTo>
            <targetReference>Roll_back_changes</targetReference>
        </faultConnector>
        <inputReference>advice</inputReference>
    </recordUpdates>
    <recordUpdates>
        <name>Update_advice_checklist</name>
        <label>Update advice checklist</label>
        <locationX>578</locationX>
        <locationY>2696</locationY>
        <connector>
            <targetReference>Update_advice</targetReference>
        </connector>
        <filterLogic>and</filterLogic>
        <filters>
            <field>Id</field>
            <operator>EqualTo</operator>
            <value>
                <elementReference>adviceChecklistId</elementReference>
            </value>
        </filters>
        <inputAssignments>
            <field>RecordTypeId</field>
            <value>
                <elementReference>GetAdviceChecklistRecordTypeId.recordTypeId</elementReference>
            </value>
        </inputAssignments>
        <object>AdviceChecklist__c</object>
    </recordUpdates>
    <runInMode>SystemModeWithoutSharing</runInMode>
    <screens>
        <name>Choose_advice_type</name>
        <label>Choose advice type</label>
        <locationX>666</locationX>
        <locationY>1340</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Warning_to_display</targetReference>
        </connector>
        <fields>
            <name>AdviceTypeSelect</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>AdviceType__c</typeValue>
            </dataTypeMappings>
            <extensionName>flowruntime:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Data Table</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>selectionMode</name>
                <value>
                    <stringValue>SINGLE_SELECT</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>minRowSelection</name>
                <value>
                    <numberValue>1.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>adviceTypes</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>maxRowSelection</name>
                <value>
                    <numberValue>1.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columns</name>
                <value>
                    <stringValue>[{&quot;apiName&quot;:&quot;Name&quot;,&quot;guid&quot;:&quot;column-b10e&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:0,&quot;label&quot;:&quot;Advice Type Name&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;Description__c&quot;,&quot;guid&quot;:&quot;column-6207&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:1,&quot;label&quot;:&quot;Description&quot;,&quot;type&quot;:&quot;text&quot;}]</stringValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Display_warning</name>
        <label>Display warning</label>
        <locationX>534</locationX>
        <locationY>1556</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Get_advice_details</targetReference>
        </connector>
        <fields>
            <name>ModalWarnings</name>
            <extensionName>c:confirmModalFlow</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>navigateForwardOnConfirm</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>navigateBackOnCancel</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Information</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>theme</name>
                <value>
                    <stringValue>info</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>variant</name>
                <value>
                    <stringValue>header</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>message</name>
                <value>
                    <elementReference>AdviceTypeSelect.firstSelectedRow.Warnings__c</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Error_toast_and_message</name>
        <label>Error toast and message</label>
        <locationX>314</locationX>
        <locationY>2696</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>ToastError</name>
            <extensionName>c:displayToastFlow</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>mode</name>
                <value>
                    <stringValue>dismissible</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>title</name>
                <value>
                    <stringValue>Error</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>triggerNavigationNextEvent</name>
                <value>
                    <booleanValue>false</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>variant</name>
                <value>
                    <stringValue>error</stringValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <fields>
            <name>Error</name>
            <fieldText>&lt;p&gt;The following error occurred. Resolve if you can or raise a ticket for support. &lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;{!$Flow.FaultMessage}&lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Existing_advice_check</name>
        <label>Existing advice check</label>
        <locationX>534</locationX>
        <locationY>1040</locationY>
        <allowBack>true</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Get_advice_types</targetReference>
        </connector>
        <fields>
            <name>existing_advice_message</name>
            <fieldText>&lt;p&gt;There is open advice already for this customer. Proceed only if you cannot combine the advice. &lt;/p&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
        </fields>
        <fields>
            <name>ExistingAdvice</name>
            <dataTypeMappings>
                <typeName>T</typeName>
                <typeValue>Advice__c</typeValue>
            </dataTypeMappings>
            <extensionName>flowruntime:datatable</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>label</name>
                <value>
                    <stringValue>Data Table</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>selectionMode</name>
                <value>
                    <stringValue>NO_SELECTION</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>minRowSelection</name>
                <value>
                    <numberValue>0.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>tableData</name>
                <value>
                    <elementReference>Search_for_open_advice</elementReference>
                </value>
            </inputParameters>
            <inputParameters>
                <name>maxRowSelection</name>
                <value>
                    <numberValue>0.0</numberValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>columns</name>
                <value>
                    <stringValue>[{&quot;apiName&quot;:&quot;Name&quot;,&quot;guid&quot;:&quot;column-99fb&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:0,&quot;label&quot;:&quot;Search Name&quot;,&quot;type&quot;:&quot;text&quot;},{&quot;apiName&quot;:&quot;OW_advice_reason__c&quot;,&quot;guid&quot;:&quot;column-f061&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:1,&quot;label&quot;:&quot;Advice reason&quot;,&quot;type&quot;:&quot;customRichText&quot;},{&quot;apiName&quot;:&quot;Advice_Status__c&quot;,&quot;guid&quot;:&quot;column-0463&quot;,&quot;editable&quot;:false,&quot;hasCustomHeaderLabel&quot;:false,&quot;customHeaderLabel&quot;:&quot;&quot;,&quot;wrapText&quot;:true,&quot;order&quot;:2,&quot;label&quot;:&quot;Status&quot;,&quot;type&quot;:&quot;text&quot;}]</stringValue>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Get_advice_details</name>
        <label>Get advice details</label>
        <locationX>666</locationX>
        <locationY>1748</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>GetAdviceRecordTypeId</targetReference>
        </connector>
        <fields>
            <name>AdviceName</name>
            <dataType>String</dataType>
            <defaultValue>
                <elementReference>nameDefault</elementReference>
            </defaultValue>
            <fieldText>Name</fieldText>
            <fieldType>InputField</fieldType>
            <helpText>&lt;p&gt;Be concise - 50 character limit - e.g. &lt;i&gt;Cash for investment&lt;/i&gt; or &lt;i&gt;ISA topup&lt;/i&gt;&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Include client(s) surname &amp;amp; ideally initial&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;p&gt;Examples:&lt;/p&gt;&lt;p&gt;Full review - Cockwell, S&lt;/p&gt;&lt;p&gt;Investment of cash | Cockwell, S&lt;/p&gt;</helpText>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Maximum of 50 characters&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!AdviceName}) &lt;= 50</formulaExpression>
            </validationRule>
        </fields>
        <fields>
            <name>RegularAmendmentInstructions</name>
            <fieldText>&lt;p&gt;For regular amendment advice you must specify these details in the notes section:&lt;/p&gt;&lt;p&gt;&lt;br&gt;&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Whether the client requested a cancellation or reduction &lt;/li&gt;&lt;li&gt;If a reduction, by how much&lt;/li&gt;&lt;li&gt;When this amendment should take effect from&lt;/li&gt;&lt;li&gt;What method did we receive the request&lt;/li&gt;&lt;/ul&gt;</fieldText>
            <fieldType>DisplayText</fieldType>
            <visibilityRule>
                <conditionLogic>and</conditionLogic>
                <conditions>
                    <leftValueReference>AdviceTypeSelect.firstSelectedRow.DeveloperName__c</leftValueReference>
                    <operator>EqualTo</operator>
                    <rightValue>
                        <stringValue>REGULAR_AMENDMENT</stringValue>
                    </rightValue>
                </conditions>
            </visibilityRule>
        </fields>
        <fields>
            <name>AdviceNotes</name>
            <defaultValue>
                <stringValue>{!advice.OW_notes__c}</stringValue>
            </defaultValue>
            <fieldText>Notes</fieldText>
            <fieldType>LargeTextArea</fieldType>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <validationRule>
                <errorMessage>&lt;p&gt;Max length 32768 characters&lt;/p&gt;</errorMessage>
                <formulaExpression>LEN({!AdviceNotes}) &lt;= 32768</formulaExpression>
            </validationRule>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Redirect_to_advice</name>
        <label>Redirect to advice</label>
        <locationX>798</locationX>
        <locationY>3344</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <fields>
            <name>NavigateToAdvice</name>
            <extensionName>c:recordNavigateToView</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>recordId</name>
                <value>
                    <elementReference>advice.Id</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <screens>
        <name>Success_toast</name>
        <label>Success toast</label>
        <locationX>666</locationX>
        <locationY>3128</locationY>
        <allowBack>false</allowBack>
        <allowFinish>true</allowFinish>
        <allowPause>false</allowPause>
        <connector>
            <targetReference>Created_from</targetReference>
        </connector>
        <fields>
            <name>ToastAdviceCreatedSuccess</name>
            <extensionName>c:displayToastFlow</extensionName>
            <fieldType>ComponentInstance</fieldType>
            <inputParameters>
                <name>mode</name>
                <value>
                    <stringValue>dismissible</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>title</name>
                <value>
                    <stringValue>Success!</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>triggerNavigationNextEvent</name>
                <value>
                    <booleanValue>true</booleanValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>variant</name>
                <value>
                    <stringValue>success</stringValue>
                </value>
            </inputParameters>
            <inputParameters>
                <name>message</name>
                <value>
                    <elementReference>successToastMessage</elementReference>
                </value>
            </inputParameters>
            <inputsOnNextNavToAssocScrn>UseStoredValues</inputsOnNextNavToAssocScrn>
            <isRequired>true</isRequired>
            <storeOutputAutomatically>true</storeOutputAutomatically>
        </fields>
        <showFooter>true</showFooter>
        <showHeader>false</showHeader>
    </screens>
    <start>
        <locationX>540</locationX>
        <locationY>0</locationY>
        <connector>
            <targetReference>Launched_from</targetReference>
        </connector>
    </start>
    <status>Active</status>
    <variables>
        <name>advice</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
        <objectType>Advice__c</objectType>
    </variables>
    <variables>
        <name>adviceChecklistId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>adviceId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>adviceTypes</name>
        <dataType>SObject</dataType>
        <isCollection>true</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>AdviceType__c</objectType>
    </variables>
    <variables>
        <name>errorMessage</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>true</isOutput>
    </variables>
    <variables>
        <description>The household for which this advice will be given</description>
        <name>household</name>
        <dataType>SObject</dataType>
        <isCollection>false</isCollection>
        <isInput>false</isInput>
        <isOutput>false</isOutput>
        <objectType>Account</objectType>
    </variables>
    <variables>
        <description>Stores the ID of the household for which this advice will be given.</description>
        <name>householdId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>isReview</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
    <variables>
        <description>Sets the household ID to be the ID of the record from whose page this flow was launched.</description>
        <name>recordId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <description>Takes the ID of a review an an input so that the advice can be linked to this on creation.</description>
        <name>reviewId</name>
        <dataType>String</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
    </variables>
    <variables>
        <name>updateAdvice</name>
        <dataType>Boolean</dataType>
        <isCollection>false</isCollection>
        <isInput>true</isInput>
        <isOutput>false</isOutput>
        <value>
            <booleanValue>false</booleanValue>
        </value>
    </variables>
</Flow>
